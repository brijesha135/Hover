<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-image: url('https://cdn-icons-png.flaticon.com/512/608/608755.png');
            background-size: cover;
            color: white;
        }

        #game-board {
            position: relative;
            width: 400px; /* Board size */
            height: 400px; /* Board height */
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            margin-bottom: 20px;
            background-color: transparent;
        }

        .car {
            background-image: url('https://cdn-icons-png.flaticon.com/512/741/741407.png');
            background-size: contain;
            background-repeat: no-repeat;
            width: 100%;
            height: 100%;
            cursor: pointer;
            transform: scale(1.25);
        }

        .block {
            background-image: url('https://cdn-icons-png.flaticon.com/512/1255/1255863.png');
            background-size: cover;
            opacity: 0.8; /* Adjusted opacity for better visibility */
        }

        .exit {
            background-image: url('https://img.icons8.com/ios-filled/50/000000/parking.png');
            background-size: cover;
        }

        .winning-area {
            background-image: url('https://img.icons8.com/ios-filled/50/000000/parking.png');
            background-size: cover;
            grid-column: 7 / span 2;
            grid-row: 7 / span 2;
            opacity: 0;
        }

        #score {
            margin-top: 20px;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div id="game-board"></div>
    <div id="score">Moves: <span id="move-count">0</span></div>
    <button id="restart-button">Restart Level</button>

    <script>
        const gameBoard = document.getElementById('game-board');
        const moveCountElement = document.getElementById('move-count');
        const boardSize = 8; 
        let cars = [];
        let selectedCarIndex = null; 
        let moveCount = 0;
        let currentLevel = 0;

        const levels = [
            { exit: { x: 8, y: 8 }, blocks: generateRandomBlocks(3), carPositions: [{ x: 1, y: 1 }] },
            { exit: { x: 8, y: 8 }, blocks: generateRandomBlocks(3), carPositions: [{ x: 1, y: 1 }, { x: 1, y: 2 }] },
            { exit: { x: 8, y: 8 }, blocks: generateRandomBlocks(4), carPositions: [{ x: 1, y: 1 }, { x: 1, y: 2 }, { x: 1, y: 3 }] },
            { exit: { x: 8, y: 8 }, blocks: generateRandomBlocks(4), carPositions: [{ x: 1, y: 1 }, { x: 1, y: 2 }, { x: 1, y: 3 }, { x: 1, y: 4 }] }
        ];

        function generateRandomBlocks(num) {
            const blocks = [];
            while (blocks.length < num) {
                const x = Math.floor(Math.random() * (boardSize - 2)) + 1; 
                const y = Math.floor(Math.random() * (boardSize - 2)) + 1; 
                if (!blocks.some(block => block.x === x && block.y === y) && 
                    !cars.some(car => car.x === x && car.y === y)) { // Ensure no overlap with cars
                    blocks.push({ x, y });
                }
            }
            return blocks;
        }

        function setupBoard() {
            gameBoard.innerHTML = '';
            cars = [];
            moveCount = 0;
            moveCountElement.textContent = moveCount;

            const level = levels[currentLevel];

            level.blocks.forEach(block => {
                const blockDiv = document.createElement('div');
                blockDiv.className = 'block';
                blockDiv.style.gridColumn = block.x;
                blockDiv.style.gridRow = block.y;
                gameBoard.appendChild(blockDiv);
            });

            const exitDiv = document.createElement('div');
            exitDiv.className = 'exit';
            exitDiv.style.gridColumn = level.exit.x;
            exitDiv.style.gridRow = level.exit.y;
            gameBoard.appendChild(exitDiv);

            const winningArea = document.createElement('div');
            winningArea.className = 'winning-area';
            gameBoard.appendChild(winningArea);

            level.carPositions.forEach(carPosition => {
                cars.push(carPosition);
                createCar(carPosition);
            });

            updateCarPosition(cars);
        }

        function createCar(position) {
            const carDiv = document.createElement('div');
            carDiv.className = 'car';
            carDiv.style.gridColumn = position.x;
            carDiv.style.gridRow = position.y;
            carDiv.addEventListener('click', () => selectCar(cars.indexOf(position)));
            gameBoard.appendChild(carDiv);
        }

        function selectCar(index) {
            selectedCarIndex = index; 
            const carElements = document.querySelectorAll('.car');
            carElements.forEach((carElement, i) => {
                carElement.style.border = (i === selectedCarIndex) ? '2px solid yellow' : 'none'; 
            });
        }

        function moveCar(newX, newY) {
            if (selectedCarIndex === null) return;

            const level = levels[currentLevel];
            const carIndex = selectedCarIndex;

            if (newX < 1 || newY < 1 || newX > boardSize || newY > boardSize) return;

            for (const block of level.blocks) {
                if (block.x === newX && block.y === newY) {
                    return; 
                }
            }

            for (let i = 0; i < cars.length; i++) {
                if (i !== carIndex && cars[i].x === newX && cars[i].y === newY) {
                    return; 
                }
            }

            cars[carIndex] = { x: newX, y: newY };
            updateCarPosition(cars);
            moveCount++;
            moveCountElement.textContent = moveCount;

            checkWinCondition();
        }

        function updateCarPosition(cars) {
            const carElements = document.querySelectorAll('.car');
            carElements.forEach((carElement, index) => {
                if (index < cars.length) {
                    carElement.style.gridColumn = cars[index].x;
                    carElement.style.gridRow = cars[index].y;
                }
            });
        }

        function checkWinCondition() {
            const level = levels[currentLevel];
            const parkedCars = cars.filter(pos => 
                (pos.x >= 7 && pos.x <= 8) && (pos.y >= 7 && pos.y <= 8)
            );

            if (parkedCars.length === cars.length) {
                alert(`You've parked all cars in ${moveCount} moves!`);
                nextLevel();
            }
        }

        function nextLevel() {
            if (currentLevel < levels.length - 1) {
                currentLevel++;
            } else {
                alert("You've completed all levels! Restarting...");
                currentLevel = 0; 
            }
            setupBoard();
        }

        document.getElementById('restart-button').addEventListener('click', setupBoard);

        document.addEventListener('keydown', (event) => {
            if (selectedCarIndex !== null) {
                const key = event.key;

                switch (key) {
                    case 'ArrowUp':
                        moveCar(cars[selectedCarIndex].x, cars[selectedCarIndex].y - 1);
                        break;
                    case 'ArrowDown':
                        moveCar(cars[selectedCarIndex].x, cars[selectedCarIndex].y + 1);
                        break;
                    case 'ArrowLeft':
                        moveCar(cars[selectedCarIndex].x - 1, cars[selectedCarIndex].y);
                        break;
                    case 'ArrowRight':
                        moveCar(cars[selectedCarIndex].x + 1, cars[selectedCarIndex].y);
                        break;
                }
            }
        });

        setupBoard();
    </script>
</body>
</html>
